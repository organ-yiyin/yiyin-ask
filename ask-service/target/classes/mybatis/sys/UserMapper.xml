<!DOCTYPE mapper PUBLIC     
    "-//mybatis.org//DTD Mapper 3.0//EN"    
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sys.user">
	<select id="findById" parameterType="int"
		resultType="com.yiyn.ask.sys.po.UserPo">
		select * from T_USER where user_id =
		#{user_id};
	</select>
	
	<select id="find"  lang="velocity" resultType="java.util.HashMap">
        select * from T_USER 
        #if("$!{_parameter.param.id}"!="")
		where user_id = @{param.id}
		#else
		where 1=0
		#end
    </select>
	
	<select id="findByUsername" parameterType="String" resultType="com.yiyn.ask.sys.po.UserPo">
        select * from T_USER where user_name =#{user_name} and enabled='Y'; 
    </select>
	
	<select id="searchByConditions" parameterType="com.yiyn.ask.base.utils.PaginationUtils" resultType="com.yiyn.ask.sys.po.UserPo">
	    select * from T_USER u
	    <if test="paramMap.role_id != null and '' != paramMap.role_id ">
	    ,T_USER_ROLE ur 
	    </if>
	    where 1=1 
		<if test="paramMap.user_name != null and '' != paramMap.user_name">  
              AND u.user_name like CONCAT('%',#{paramMap.user_name},'%')  
        </if>
        <if test="paramMap.full_name != null and '' != paramMap.full_name">  
              AND u.full_name like CONCAT('%',#{paramMap.full_name},'%')  
        </if>
        <if test="paramMap.enabled != null and '' != paramMap.enabled ">  
              AND u.enabled =  #{paramMap.enabled} 
        </if> 
        <if test="paramMap.role_id != null and '' != paramMap.role_id ">
			AND u.user_id = ur.user_id AND ur.role_id = #{paramMap.role_id}
		</if>
         order by u.update_time desc
		limit #{startIndex}, #{numPerPage}
	</select>
	
	<select id="searchCountByConditions" parameterType="java.util.HashMap" resultType="int">
		
	    select count(*) as totalCount from T_USER u
	    <if test="paramMap.role_id != null and '' != paramMap.role_id ">
	    ,T_USER_ROLE ur 
	    </if>
	    where 1=1 
		<if test="paramMap.user_name != null and '' != paramMap.user_name">  
              AND u.user_name like CONCAT('%',#{paramMap.user_name},'%')  
        </if>
        <if test="paramMap.full_name != null and '' != paramMap.full_name">  
              AND u.full_name like CONCAT('%',#{paramMap.full_name},'%')  
        </if>
        <if test="paramMap.enabled != null and '' != paramMap.enabled ">  
              AND u.enabled =  #{paramMap.enabled} 
        </if> 
        <if test="paramMap.role_id != null and '' != paramMap.role_id ">
			AND u.user_id = ur.user_id AND ur.role_id = #{paramMap.role_id}
		</if>
       
	</select>
	
	<insert id="insert" parameterType="com.yiyn.ask.sys.po.UserPo" useGeneratedKeys="true" keyProperty="user_id">
		insert into
		T_USER(USER_NAME,CENTRE_ID,FULL_NAME,PASSWORD,ISADMIN,ENABLED,CREATOR,CREATE_TIME,UPDATER,UPDATE_TIME)
		values(#{user_name},#{centre_id},#{full_name},#{password},#{isadmin},#{enabled},#{creator},#{create_time},#{updater},#{update_time});
	</insert>

	<update id="updateById" parameterType="com.yiyn.ask.sys.po.UserPo">
		update T_USER
		set
		USER_NAME=#{user_name},centre_id=#{centre_id},FULL_NAME=#{full_name},
		ISADMIN=#{isadmin},ENABLED=#{enabled},
		UPDATER=#{updater},UPDATE_TIME=#{update_time}
		where user_id =#{user_id};
	</update>
	
	<update id="updatePasswordById" parameterType="com.yiyn.ask.sys.po.UserPo">
		update T_USER
		set
		password=#{password},
		UPDATER=#{updater},UPDATE_TIME=#{update_time}
		where user_id =#{user_id};
	</update>
	
	<delete id="deleteById" parameterType="int">
	    delete from T_USER where user_id=#{user_id}; 
	</delete>
	
	<delete id="deleteByIds">
	    delete from T_USER where user_id in
        <foreach item="item" index="index" collection="array" open="(" separator="," close=")">
            #{item}
        </foreach>
	</delete>

</mapper>