<!DOCTYPE mapper PUBLIC     
    "-//mybatis.org//DTD Mapper 3.0//EN"    
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yiyin.consult.bg">
	<select id="searchByConditions"
		parameterType="com.yiyn.ask.base.utils.PaginationUtils" resultType="java.util.HashMap">
		select cs.*,
		c.user_phone as c_user_phone from consultation_sheet cs,user_c c
		where 1=1
		and cs.user_c_id = c.user_id
		
		<if test="paramMap.user_c_phone != null and '' != paramMap.user_c_phone">
			AND c.user_phone = #{paramMap.user_c_phone}
		</if>
		<if test="paramMap.odd_num != null and '' != paramMap.odd_num">
			AND cs.odd_num = #{paramMap.odd_num}
		</if>
		<if test="paramMap.status != null and '' != paramMap.status">
			AND cs.status = #{paramMap.status}
		</if>
		<if test="paramMap.start_booking_time!=null and paramMap.start_booking_time!=''">
			<![CDATA[
              AND DATE_FORMAT(cs.booking_time,'%Y-%m-%d')  >=  #{paramMap.start_booking_time} 
               ]]>
		</if>
		<if test="paramMap.end_booking_time!=null and paramMap.end_booking_time!=''">
			<![CDATA[
              AND DATE_FORMAT(cs.booking_time,'%Y-%m-%d')  <=  #{paramMap.end_booking_time} 
               ]]>
		</if>
		order by cs.CREATED_BY desc
		limit #{startIndex}, #{numPerPage}
	</select>
	
	<select id="searchCountByConditions" parameterType="java.util.HashMap" resultType="int">
	    select count(*) from consultation_sheet cs,user_c c
		where 1=1
		and cs.user_c_id = c.user_id
		
		<if test="paramMap.user_c_phone != null and '' != paramMap.user_c_phone">
			AND c.user_phone = #{paramMap.user_c_phone}
		</if>
		<if test="paramMap.odd_num != null and '' != paramMap.odd_num">
			AND cs.odd_num = #{paramMap.odd_num}
		</if>
		<if test="paramMap.status != null and '' != paramMap.status">
			AND cs.status = #{paramMap.status}
		</if>
		<if test="paramMap.start_booking_time!=null and paramMap.start_booking_time!=''">
			<![CDATA[
              AND DATE_FORMAT(cs.booking_time,'%Y-%m-%d')  >=  #{paramMap.start_booking_time} 
               ]]>
		</if>
		<if test="paramMap.end_booking_time!=null and paramMap.end_booking_time!=''">
			<![CDATA[
              AND DATE_FORMAT(cs.booking_time,'%Y-%m-%d')  <=  #{paramMap.end_booking_time} 
               ]]>
		</if>
	</select>
</mapper>