<!DOCTYPE mapper PUBLIC     
    "-//mybatis.org//DTD Mapper 3.0//EN"    
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 账户提现记录表 -->
<mapper namespace="yiyin.withdraw">
    <select id="getWithDraw" resultType="com.yiyn.ask.xcx.account.po.AccountWithDrawPo" parameterType="String">
        
    </select>
    
    <!-- 提现点击后插入账户流水表和提现记录表  -->
    <insert id="insert" parameterType="com.yiyn.ask.xcx.account.po.AccountWithDrawPo" useGeneratedKeys="true" keyProperty="id">
		insert into user_withdraw(account_id,order_id,withdraw,withdraw_type,created_by,created_time)
		values (#{account_id},#{order_id},#{withdraw},#{withdraw_type},#{created_by},now())
	</insert>
	
	<select id="searchByConditions_bg" parameterType="com.yiyn.ask.base.utils.PaginationUtils" resultType="java.util.HashMap">
	    select uw.*,ub.user_no as ub_user_no from user_withdraw uw, user_account ua, user_b ub
	    where 1=1 and uw.account_id = ua.id and ua.user_b_id = ub.id
	    <if test="paramMap.status != null and '' != paramMap.status">  
              AND uw.status = #{paramMap.status}
        </if>
	    <if test="paramMap.withdraw_type != null and '' != paramMap.withdraw_type">  
              AND uw.withdraw_type = #{paramMap.withdraw_type}
        </if>
		<if test="paramMap.user_no != null and '' != paramMap.user_no">  
              AND ub.user_no = #{paramMap.user_no}
        </if>
        order by uw.UPDATED_TIME desc
		limit #{startIndex}, #{numPerPage}
	</select>
	
	<select id="searchCountByConditions_bg" parameterType="java.util.HashMap" resultType="int">
	    select count(*) from user_withdraw uw, user_account ua, user_b ub
	    where 1=1 and uw.account_id = ua.id and ua.user_b_id = ub.id
	    <if test="paramMap.status != null and '' != paramMap.status">  
              AND uw.status = #{paramMap.status}
        </if>
	    <if test="paramMap.withdraw_type != null and '' != paramMap.withdraw_type">  
              AND uw.withdraw_type = #{paramMap.withdraw_type}
        </if>
		<if test="paramMap.user_no != null and '' != paramMap.user_no">  
              AND ub.user_no = #{paramMap.user_no}
        </if>
	</select>
	
</mapper>