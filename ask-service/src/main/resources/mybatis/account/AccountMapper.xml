<!DOCTYPE mapper PUBLIC     
    "-//mybatis.org//DTD Mapper 3.0//EN"    
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yiyin.account">
    <select id="getAccountInfo" resultType="com.yiyn.ask.xcx.account.po.AccountPo" parameterType="String">
      select t.user_no,t.id,
      cast(t.WITHDRAW_enable as decimal(9,2)) as withdraw_enable,
      cast(t.BALANCE as decimal(9,2)) as balance,
      cast(sum(m.income_total) as decimal(9,2))  as income_total,
	  case when m.STAT_MONTH = DATE_FORMAT(date_sub(now(),INTERVAL 1 month),'%Y-%m') then cast(m.income_total as decimal(9,2)) else 0 end as income_last_m
	  from user_account t left join stat_account_m m on m.user_no = t.USER_NO
	  where t.USER_NO = #{value}
	  group by t.user_no
    </select>
    
    <!--  通知后更新账户数据 -->
    <update id="updateById" parameterType="com.yiyn.ask.xcx.account.po.AccountPo">
		update user_account
		set balance = #{balance}
		where id = #{id}
	</update>
	
    <!-- 提现后更新可提现金额为0 -->
    <update id="updWithDraw" parameterType="com.yiyn.ask.xcx.account.po.AccountPo">
		update user_account
		set withdraw_enable = 0
		where id = #{id}
	</update>
	
    <insert id="insert" parameterType="com.yiyn.ask.xcx.account.po.AccountPo" useGeneratedKeys="true" keyProperty="id">
		insert into user_account(user_b_id,user_no,balance,withdraw,user_type,user_name,revision,
		delete_flag,created_by,created_time,updated_by,updated_time)
		values (#{user_b_id},#{user_no},#{balance},#{withdraw},#{user_type},#{user_name},#{revision},
		#{delete_flag},#{created_by},#{created_time},#{updated_by},#{updated_time});
	</insert>
</mapper>